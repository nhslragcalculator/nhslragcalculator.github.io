Skip to content
Chat history


You said:
I need help with code
ChatGPT said:
Sure ‚Äî I‚Äôd be happy to help. What do you need help with?

Please share:

The programming language you‚Äôre using (e.g., Python, JavaScript, Java, etc.)

What you‚Äôre trying to do

Any code you already have

The error message (if there is one) or what‚Äôs not working as expected

You said:
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAG calculator</title>
  <style>
    body{
      font-family:Arial, sans-serif;
      background:#f3f6fb;
      color:#222;
      margin:0;
      padding:24px;
    }
    .container{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:24px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    h1{margin-top:0}
    label{display:block;margin-top:12px;font-weight:bold}
    input,select{
      width:100%;
      padding:8px;
      margin-top:4px;
      box-sizing:border-box;
      border:1px solid #ccc;
      border-radius:6px;
    }
    button{
      margin-top:20px;
      padding:10px 14px;
      background:#007bff;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover{background:#0056b3;}
    #result{
      margin-top:20px;
      padding:14px;
      border-radius:10px;
      background:#f8f9fb;
      border:1px solid #e0e4ea;
    }
    .green{color:green; font-weight:bold;}
    .amber{color:orange; font-weight:bold;}
    .red{color:red; font-weight:bold;}
    ul{margin-top:6px; padding-left:18px;}
    li{margin-bottom:4px;}

    /* Black info icon with tooltip */
    .info-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      line-height: 16px;
      border-radius: 50%;
      border: 1.5px solid #000; /* black outline */
      background: transparent;   /* transparent inside */
      color: #000;               /* black "i" */
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      margin-left: 6px;
      cursor: pointer;
      position: relative;
    }
    .info-icon .tooltip {
      visibility: hidden;
      opacity: 0;
      width: max-content;
      max-width: 250px;
      background-color: #000; /* black background */
      color: #fff;            /* white text */
      text-align: left;
      border-radius: 6px;
      padding: 6px 10px;
      position: absolute;
      z-index: 1;
      top: -5px;
      left: 105%;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.3;
      white-space: pre-wrap;
    }
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RAG Calculator</h1>

    <label>BMI</label>
    <input type="number" id="bmi" placeholder="Enter BMI" step="0.1" min="0">

    <label>Cardiac issues</label>
    <select id="cardiac">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Respiratory issues</label>
    <select id="respiratory">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Neurological issues</label>
    <select id="neurological">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Psychiatric issues</label>
    <select id="psychiatric">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Can they get out of the house on their own?</label>
    <select id="getOut">
      <option value="0">Yes</option>
      <option value="1">No</option>
    </select>

    <label>Diabetes</label>
    <select id="diabetes">
      <option value="0">None</option>
      <option value="1">Well controlled diabetes with no more than 2 medications</option>
      <option value="2">On Insulin or more than 2 diabetic medications</option>
      <option value="3">On Insulin and more than 2 other diabetic medications</option>
    </select>

    <label>Age &gt;80 for knee or &gt;85 for hip</label>
    <select id="ageFlag">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Recent hospital admission (past 6 weeks)</label>
    <select id="recentAdmit">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Are you known to be anaemic</label>
    <select id="anaemia">
      <option value="0">No / Don't know</option>
      <option value="1">Yes - stable and receiving treatment</option>
      <option value="3">Yes and waiting for further investigations</option>
    </select>

    <label>On renal replacement therapy</label>
    <select id="rrt">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>How many medications are you on (apart from pain killers)?</label>
    <input type="number" id="numMeds" placeholder="Enter number" min="0">

    <label>Revision surgery, complex primary or bilateral joints</label>
    <select id="revision">
      <option value="0">No</option>
      <option value="3">Yes</option>
    </select>

    <label>On Clopidogrel / Ticagrelor / Prasugrel</label>
    <select id="antiplatelet">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On DOAC (Apixaban / Rivaroxaban / Dabigatran etc)</label>
    <select id="doac">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On GLP1 agonist (Ozempic / Mounjaro / Wegovy / Tirzepatide / Rybelsus etc)</label>
    <select id="glp1">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On Immunosuppressants</label>
    <select id="immuno">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Patient needs more than 24 hours notice</label>
    <select id="notice">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <button onclick="calculateScore()">Calculate Score</button>

    <div id="result"></div>
  </div>

  <script>
    function calculateScore(){
      let score = 0;
      let breakdown = [];

      // Updated BMI scoring
      const bmi = parseFloat(document.getElementById('bmi').value);
      let bmiPoints = 0;
      if (!isNaN(bmi)) {
        if (bmi < 18) bmiPoints = 3;
        else if (bmi >= 18 && bmi < 20) bmiPoints = 1;
        else if (bmi >= 20 && bmi < 35) bmiPoints = 0;
        else if (bmi >= 35 && bmi < 40) bmiPoints = 1;
        else if (bmi >= 40) bmiPoints = 3;

        score += bmiPoints;
        if (bmiPoints > 0) breakdown.push(BMI (${bmi.toFixed(1)}) = ${bmiPoints} pt${bmiPoints > 1 ? 's' : ''});
      }

      const fields = [
        {id:'cardiac', label:'Cardiac issues'},
        {id:'respiratory', label:'Respiratory issues'},
        {id:'neurological', label:'Neurological issues'},
        {id:'psychiatric', label:'Psychiatric issues'},
        {id:'getOut', label:'Cannot get out of house'},
        {id:'ageFlag', label:'Age threshold exceeded'},
        {id:'recentAdmit', label:'Recent hospital admission'},
        {id:'anaemia', label:'Anaemia'},
        {id:'revision', label:'Revision/complex primary'},
      ];

      fields.forEach(f=>{
        let val = parseInt(document.getElementById(f.id).value) || 0;
        if(val>0){
          score += val;
          breakdown.push(${f.label} = ${val} pt${val>1?'s':''});
        }
      });

      const meds = parseInt(document.getElementById('numMeds').value) || 0;
      if (meds >= 5){
        score += 1;
        breakdown.push(Non-analgesic medications (${meds}) = 1 pt);
      }

      const diabetesPts = parseInt(document.getElementById('diabetes').value) || 0;
      if(diabetesPts>0){
        score += diabetesPts;
        const diabetesLabel = document.getElementById('diabetes').options[document.getElementById('diabetes').selectedIndex].text;
        breakdown.push(Diabetes: ${diabetesLabel} = ${diabetesPts} pt${diabetesPts>1?'s':''});
      }

// Different scoring for these three
const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);

// Antiplatelet = 2 points
if (antiplatelet > 0) {
  score += 2;
  breakdown.push('On Antiplatelet = 2 pts');
}

// DOAC = 2 points
if (doac > 0) {
  score += 2;
  breakdown.push('On DOAC = 2 pts');
}

// Immunosuppressants = 3 points
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

      let risk='', riskClass='';
      if (score >= 6){ risk='Red'; riskClass='red'; }
      else if (score >= 3){ risk='Amber'; riskClass='amber'; }
      else { risk='Green'; riskClass='green'; }

      const autoNoFields = ['rrt','antiplatelet','doac','glp1','immuno','notice'];
      let autoNo = autoNoFields.some(id => parseInt(document.getElementById(id).value) > 0);

      if (parseInt(document.getElementById('revision').value) === 3 ||
          parseInt(document.getElementById('anaemia').value) === 3) {
        autoNo = true;
      }

      let suitable = "Yes";
      let suitableClass = "green";
      if(score > 8 || autoNo) {
        suitable = "No";
        suitableClass = "red";
      }

      let fourJoint = "Yes";
      let fourJointClass = "green";
      let fourJointReason = "";

      let reasons = [];
      if (risk !== 'Green') reasons.push(RAG pathway is ${risk});
      if (!isNaN(bmi) && bmi >= 35) reasons.push(BMI is ${bmi.toFixed(1)} (‚â• 35));

      if (reasons.length > 0) {
        fourJoint = "No";
        fourJointClass = "red";
        fourJointReason = reasons.join(" and ");
      }

      document.getElementById('result').innerHTML =
        <strong>Total Score: ${score}</strong><br>
         <span class="${riskClass}"><strong>RAG Category: ${risk}</strong></span><br>
         <strong>Suitable to come in on same day?:</strong>
         <span class="${suitableClass}">${suitable}</span><br>
         <strong>Suitable for 4 joint list?:</strong>
         <span class="${fourJointClass}">
           ${fourJoint}
           ${fourJointReason ? <span class="info-icon">i<span class="tooltip">${fourJointReason}</span></span> : ''}
         </span>
         <div style="margin-top:10px;">
         <strong>Breakdown:</strong>
         <ul>${breakdown.map(x=><li>${x}</li>).join('')}</ul>
         </div>;
    }
  </script>
</body>
</html>
ChatGPT said:
Thanks ‚Äî I can definitely help with this, but I need to know what you want to change or fix.

Please tell me one (or more) of the following:

‚ùì What isn‚Äôt working? (Is there an error? Unexpected result?)

‚ûï Do you want to add something new? (e.g., another question, different scoring, extra output, etc.)

‚úèÔ∏è Do you want to change the logic? (e.g., how the RAG score is calculated, thresholds, ‚Äúsame day‚Äù rules, 4 joint list rules, etc.)

üé® Do you want to change the look? (layout, colours, styling, mobile view, etc.)

üñ•Ô∏è Do you want this converted? (e.g., to a web app, Excel, standalone file, or integrated into another system?)

If you can, describe in plain English what you want the calculator to do differently.

You said:
Right now DOACs and antiplatelets give 2 points. I want the points given to change depending on the points given apart from those. If the points total 0 then selecting DOACs or anti-platelets give 3 points each, 2 if the total points are 1, 1 if the total points are 2 and 0 if the total points are 3 or above
ChatGPT said:
Great ‚Äî clear rule. üëç
You want variable scoring for Antiplatelet and DOAC based on the other points first.

Logic you described (just to confirm)
If points from everything except DOAC + Antiplatelet are:

0 ‚Üí each gives 3 points

1 ‚Üí each gives 2 points

2 ‚Üí each gives 1 point

‚â• 3 ‚Üí each gives 0 points

‚úÖ What to change in your code
1Ô∏è‚É£ Remove (or comment out) your current fixed scoring block
Find this part and remove it (or replace it with the new version below):

// Antiplatelet = 2 points
if (antiplatelet > 0) {
  score += 2;
  breakdown.push('On Antiplatelet = 2 pts');
}

// DOAC = 2 points
if (doac > 0) {
  score += 2;
  breakdown.push('On DOAC = 2 pts');
}
2Ô∏è‚É£ Replace it with this new variable scoring version
üëâ Place this in the same spot where the old block was:

// ---- VARIABLE SCORING FOR ANTIPLATELET & DOAC ----

// At this point, 'score' includes everything EXCEPT antiplatelet + DOAC

let baseScore = score; // store current total before adding these

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(`On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}
‚úÖ Example of how this will now behave
Other score (before drugs)	Antiplatelet adds	DOAC adds
0	3	3
1	2	2
2	1	1
‚â• 3	0	0
So if someone has:

BMI points = 1

No other risks
‚Üí Base score = 1
‚Üí Each of DOAC/Antiplatelet = 2 points

If you‚Äôd like, I can:
update the breakdown wording to make this clearer to users, or

adjust the logic so having both drugs doesn‚Äôt double-count in a way you don‚Äôt want, or

add this rule visibly to the UI with an info tooltip.

Just tell me üëç

You said:
that didn't work. If I give 3 points for respiratory, it gives 2 points for DOAC
ChatGPT said:
Good catch ‚Äî your result tells us the new code is in the wrong place in the function, so the ‚Äúbase score‚Äù is not actually excluding DOAC/antiplatelet when it‚Äôs calculated.

You need to calculate the variable points before you add anything for antiplatelet or DOAC.

Below is the correct drop-in replacement for that whole section.

‚úÖ Replace your current drug-scoring block with this
Find this part in your script:

const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);
And everything that follows it about antiplatelet/DOAC.

Replace it entirely with this:

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);

// üîπ Capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// Apply to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(`On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// Immunosuppressants still fixed at 3 points (unchanged)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}
‚úÖ Now it will behave correctly
Example tests
Other score (before drugs)	DOAC adds	Antiplatelet adds
0	3	3
1	2	2
2	1	1
3 (e.g., respiratory = 3)	0	0
So in your case:

Respiratory = 3

Base score = 3
‚û° DOAC should now correctly add 0, not 2.

If you want, I can also:

show this rule in an on-screen tooltip, or

include the ‚Äúbase score before drugs‚Äù in the breakdown so it‚Äôs transparent to users.

You said:
It's not working at all now
ChatGPT said:
Thanks for your patience ‚Äî the issue is purely about where this code sits in your function.
Right now the variable calculation is being done too early in the function, so baseScore is not what you think it is.

Below is a working version and exactly where it must go.

‚úÖ What actually needs to change (important)
You want:

‚Äúpoints apart from DOAC and antiplatelet‚Äù

So baseScore must be calculated after everything else (BMI, comorbidities, diabetes, meds, and immunosuppressants), but before DOAC and antiplatelet.

‚ùå First: DELETE / REMOVE THIS ENTIRE BLOCK from earlier in the function
Remove this section wherever you placed it earlier:

const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);

// üîπ Capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// Apply to DOAC
if (doac
You said:
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAG calculator</title>
  <style>
    body{
      font-family:Arial, sans-serif;
      background:#f3f6fb;
      color:#222;
      margin:0;
      padding:24px;
    }
    .container{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:24px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    h1{margin-top:0}
    label{display:block;margin-top:12px;font-weight:bold}
    input,select{
      width:100%;
      padding:8px;
      margin-top:4px;
      box-sizing:border-box;
      border:1px solid #ccc;
      border-radius:6px;
    }
    button{
      margin-top:20px;
      padding:10px 14px;
      background:#007bff;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover{background:#0056b3;}
    #result{
      margin-top:20px;
      padding:14px;
      border-radius:10px;
      background:#f8f9fb;
      border:1px solid #e0e4ea;
    }
    .green{color:green; font-weight:bold;}
    .amber{color:orange; font-weight:bold;}
    .red{color:red; font-weight:bold;}
    ul{margin-top:6px; padding-left:18px;}
    li{margin-bottom:4px;}

    /* Black info icon with tooltip */
    .info-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      line-height: 16px;
      border-radius: 50%;
      border: 1.5px solid #000; /* black outline */
      background: transparent;   /* transparent inside */
      color: #000;               /* black "i" */
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      margin-left: 6px;
      cursor: pointer;
      position: relative;
    }
    .info-icon .tooltip {
      visibility: hidden;
      opacity: 0;
      width: max-content;
      max-width: 250px;
      background-color: #000; /* black background */
      color: #fff;            /* white text */
      text-align: left;
      border-radius: 6px;
      padding: 6px 10px;
      position: absolute;
      z-index: 1;
      top: -5px;
      left: 105%;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.3;
      white-space: pre-wrap;
    }
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RAG Calculator</h1>

    <label>BMI</label>
    <input type="number" id="bmi" placeholder="Enter BMI" step="0.1" min="0">

    <label>Cardiac issues</label>
    <select id="cardiac">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Respiratory issues</label>
    <select id="respiratory">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Neurological issues</label>
    <select id="neurological">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Psychiatric issues</label>
    <select id="psychiatric">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Can they get out of the house on their own?</label>
    <select id="getOut">
      <option value="0">Yes</option>
      <option value="1">No</option>
    </select>

    <label>Diabetes</label>
    <select id="diabetes">
      <option value="0">None</option>
      <option value="1">Well controlled diabetes with no more than 2 medications</option>
      <option value="2">On Insulin or more than 2 diabetic medications</option>
      <option value="3">On Insulin and more than 2 other diabetic medications</option>
    </select>

    <label>Age &gt;80 for knee or &gt;85 for hip</label>
    <select id="ageFlag">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Recent hospital admission (past 6 weeks)</label>
    <select id="recentAdmit">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Are you known to be anaemic</label>
    <select id="anaemia">
      <option value="0">No / Don't know</option>
      <option value="1">Yes - stable and receiving treatment</option>
      <option value="3">Yes and waiting for further investigations</option>
    </select>

    <label>On renal replacement therapy</label>
    <select id="rrt">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>How many medications are you on (apart from pain killers)?</label>
    <input type="number" id="numMeds" placeholder="Enter number" min="0">

    <label>Revision surgery, complex primary or bilateral joints</label>
    <select id="revision">
      <option value="0">No</option>
      <option value="3">Yes</option>
    </select>

    <label>On Clopidogrel / Ticagrelor / Prasugrel</label>
    <select id="antiplatelet">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On DOAC (Apixaban / Rivaroxaban / Dabigatran etc)</label>
    <select id="doac">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On GLP1 agonist (Ozempic / Mounjaro / Wegovy / Tirzepatide / Rybelsus etc)</label>
    <select id="glp1">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On Immunosuppressants</label>
    <select id="immuno">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Patient needs more than 24 hours notice</label>
    <select id="notice">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <button onclick="calculateScore()">Calculate Score</button>

    <div id="result"></div>
  </div>

  <script>
    function calculateScore(){
      let score = 0;
      let breakdown = [];

      // Updated BMI scoring
      const bmi = parseFloat(document.getElementById('bmi').value);
      let bmiPoints = 0;
      if (!isNaN(bmi)) {
        if (bmi < 18) bmiPoints = 3;
        else if (bmi >= 18 && bmi < 20) bmiPoints = 1;
        else if (bmi >= 20 && bmi < 35) bmiPoints = 0;
        else if (bmi >= 35 && bmi < 40) bmiPoints = 1;
        else if (bmi >= 40) bmiPoints = 3;

        score += bmiPoints;
        if (bmiPoints > 0) breakdown.push(BMI (${bmi.toFixed(1)}) = ${bmiPoints} pt${bmiPoints > 1 ? 's' : ''});
      }

      const fields = [
        {id:'cardiac', label:'Cardiac issues'},
        {id:'respiratory', label:'Respiratory issues'},
        {id:'neurological', label:'Neurological issues'},
        {id:'psychiatric', label:'Psychiatric issues'},
        {id:'getOut', label:'Cannot get out of house'},
        {id:'ageFlag', label:'Age threshold exceeded'},
        {id:'recentAdmit', label:'Recent hospital admission'},
        {id:'anaemia', label:'Anaemia'},
        {id:'revision', label:'Revision/complex primary'},
      ];

      fields.forEach(f=>{
        let val = parseInt(document.getElementById(f.id).value) || 0;
        if(val>0){
          score += val;
          breakdown.push(${f.label} = ${val} pt${val>1?'s':''});
        }
      });

      const meds = parseInt(document.getElementById('numMeds').value) || 0;
      if (meds >= 5){
        score += 1;
        breakdown.push(Non-analgesic medications (${meds}) = 1 pt);
      }

      const diabetesPts = parseInt(document.getElementById('diabetes').value) || 0;
      if(diabetesPts>0){
        score += diabetesPts;
        const diabetesLabel = document.getElementById('diabetes').options[document.getElementById('diabetes').selectedIndex].text;
        breakdown.push(Diabetes: ${diabetesLabel} = ${diabetesPts} pt${diabetesPts>1?'s':''});
      }

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);

// üîπ Capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// Apply to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// Immunosuppressants still fixed at 3 points (unchanged)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

// Antiplatelet = 2 points
if (antiplatelet > 0) {
  score += 2;
  breakdown.push('On Antiplatelet = 2 pts');
}

// ---- VARIABLE SCORING FOR ANTIPLATELET & DOAC ----

// At this point, 'score' includes everything EXCEPT antiplatelet + DOAC

let baseScore = score; // store current total before adding these

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

      let risk='', riskClass='';
      if (score >= 6){ risk='Red'; riskClass='red'; }
      else if (score >= 3){ risk='Amber'; riskClass='amber'; }
      else { risk='Green'; riskClass='green'; }

      const autoNoFields = ['rrt','antiplatelet','doac','glp1','immuno','notice'];
      let autoNo = autoNoFields.some(id => parseInt(document.getElementById(id).value) > 0);

      if (parseInt(document.getElementById('revision').value) === 3 ||
          parseInt(document.getElementById('anaemia').value) === 3) {
        autoNo = true;
      }

      let suitable = "Yes";
      let suitableClass = "green";
      if(score > 8 || autoNo) {
        suitable = "No";
        suitableClass = "red";
      }

      let fourJoint = "Yes";
      let fourJointClass = "green";
      let fourJointReason = "";

      let reasons = [];
      if (risk !== 'Green') reasons.push(RAG pathway is ${risk});
      if (!isNaN(bmi) && bmi >= 35) reasons.push(BMI is ${bmi.toFixed(1)} (‚â• 35));

      if (reasons.length > 0) {
        fourJoint = "No";
        fourJointClass = "red";
        fourJointReason = reasons.join(" and ");
      }

      document.getElementById('result').innerHTML =
        <strong>Total Score: ${score}</strong><br>
         <span class="${riskClass}"><strong>RAG Category: ${risk}</strong></span><br>
         <strong>Suitable to come in on same day?:</strong>
         <span class="${suitableClass}">${suitable}</span><br>
         <strong>Suitable for 4 joint list?:</strong>
         <span class="${fourJointClass}">
           ${fourJoint}
           ${fourJointReason ? <span class="info-icon">i<span class="tooltip">${fourJointReason}</span></span> : ''}
         </span>
         <div style="margin-top:10px;">
         <strong>Breakdown:</strong>
         <ul>${breakdown.map(x=><li>${x}</li>).join('')}</ul>
         </div>;
    }
  </script>
</body>
</html>
ChatGPT said:
Thanks ‚Äî I can see the problem now. üëç

Your current file has the drug-scoring code twice, plus an old fixed ‚Äú+2 points‚Äù block, and you also redeclare baseScore and getDrugPoints twice. That will break the logic and make the scoring unpredictable.

Below I‚Äôll give you one clean, working version to drop in.

üëâ What to do: replace the whole drug section with this
Find everything from here:

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET
// -----------------------------
all the way down to just before:

let risk='', riskClass='';
Delete all of that.

‚úÖ Paste THIS SINGLE block in its place
// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET (CLEAN VERSION)
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value) || 0;
const doac = parseInt(document.getElementById('doac').value) || 0;
const immuno = parseInt(document.getElementById('immuno').value) || 0;

// First: add immunosuppressants (these are NOT part of the variable rule)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

// üëâ NOW capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply variable points to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// Apply variable points to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(`On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}
‚úÖ This will now work exactly as you specified
Examples you can test:
Case 1 ‚Äî base score = 0
No other risks ‚Üí score = 0

Select DOAC = Yes ‚Üí +3 points

Case 2 ‚Äî base score = 1
e.g. BMI gives 1 point

Select DOAC ‚Üí +2 points

Case 3 ‚Äî base score = 2
e.g. BMI 1 + meds 1

Select DOAC ‚Üí +1 point

Case 4 ‚Äî base score = 3
e.g. Respiratory = 3

Select DOAC ‚Üí +0 points (correct) ‚úÖ

Why your previous version failed
You had:

Two different ‚Äúvariable scoring‚Äù blocks

Two baseScore variables

Two getDrugPoints functions

Plus an old fixed +2 points block still in there

So the calculator was effectively scoring drugs three different ways at once.

If you like, I can:

add a tooltip that explains this rule to users, or

show ‚ÄúBase score before drugs: X‚Äù in the breakdown so it‚Äôs transparent.

You said:
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAG calculator</title>
  <style>
    body{
      font-family:Arial, sans-serif;
      background:#f3f6fb;
      color:#222;
      margin:0;
      padding:24px;
    }
    .container{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:24px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    h1{margin-top:0}
    label{display:block;margin-top:12px;font-weight:bold}
    input,select{
      width:100%;
      padding:8px;
      margin-top:4px;
      box-sizing:border-box;
      border:1px solid #ccc;
      border-radius:6px;
    }
    button{
      margin-top:20px;
      padding:10px 14px;
      background:#007bff;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover{background:#0056b3;}
    #result{
      margin-top:20px;
      padding:14px;
      border-radius:10px;
      background:#f8f9fb;
      border:1px solid #e0e4ea;
    }
    .green{color:green; font-weight:bold;}
    .amber{color:orange; font-weight:bold;}
    .red{color:red; font-weight:bold;}
    ul{margin-top:6px; padding-left:18px;}
    li{margin-bottom:4px;}

    /* Black info icon with tooltip */
    .info-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      line-height: 16px;
      border-radius: 50%;
      border: 1.5px solid #000; /* black outline */
      background: transparent;   /* transparent inside */
      color: #000;               /* black "i" */
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      margin-left: 6px;
      cursor: pointer;
      position: relative;
    }
    .info-icon .tooltip {
      visibility: hidden;
      opacity: 0;
      width: max-content;
      max-width: 250px;
      background-color: #000; /* black background */
      color: #fff;            /* white text */
      text-align: left;
      border-radius: 6px;
      padding: 6px 10px;
      position: absolute;
      z-index: 1;
      top: -5px;
      left: 105%;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.3;
      white-space: pre-wrap;
    }
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RAG Calculator</h1>

    <label>BMI</label>
    <input type="number" id="bmi" placeholder="Enter BMI" step="0.1" min="0">

    <label>Cardiac issues</label>
    <select id="cardiac">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Respiratory issues</label>
    <select id="respiratory">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Neurological issues</label>
    <select id="neurological">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Psychiatric issues</label>
    <select id="psychiatric">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Can they get out of the house on their own?</label>
    <select id="getOut">
      <option value="0">Yes</option>
      <option value="1">No</option>
    </select>

    <label>Diabetes</label>
    <select id="diabetes">
      <option value="0">None</option>
      <option value="1">Well controlled diabetes with no more than 2 medications</option>
      <option value="2">On Insulin or more than 2 diabetic medications</option>
      <option value="3">On Insulin and more than 2 other diabetic medications</option>
    </select>

    <label>Age &gt;80 for knee or &gt;85 for hip</label>
    <select id="ageFlag">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Recent hospital admission (past 6 weeks)</label>
    <select id="recentAdmit">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Are you known to be anaemic</label>
    <select id="anaemia">
      <option value="0">No / Don't know</option>
      <option value="1">Yes - stable and receiving treatment</option>
      <option value="3">Yes and waiting for further investigations</option>
    </select>

    <label>On renal replacement therapy</label>
    <select id="rrt">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>How many medications are you on (apart from pain killers)?</label>
    <input type="number" id="numMeds" placeholder="Enter number" min="0">

    <label>Revision surgery, complex primary or bilateral joints</label>
    <select id="revision">
      <option value="0">No</option>
      <option value="3">Yes</option>
    </select>

    <label>On Clopidogrel / Ticagrelor / Prasugrel</label>
    <select id="antiplatelet">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On DOAC (Apixaban / Rivaroxaban / Dabigatran etc)</label>
    <select id="doac">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On GLP1 agonist (Ozempic / Mounjaro / Wegovy / Tirzepatide / Rybelsus etc)</label>
    <select id="glp1">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On Immunosuppressants</label>
    <select id="immuno">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Patient needs more than 24 hours notice</label>
    <select id="notice">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <button onclick="calculateScore()">Calculate Score</button>

    <div id="result"></div>
  </div>

  <script>
    function calculateScore(){
      let score = 0;
      let breakdown = [];

      // Updated BMI scoring
      const bmi = parseFloat(document.getElementById('bmi').value);
      let bmiPoints = 0;
      if (!isNaN(bmi)) {
        if (bmi < 18) bmiPoints = 3;
        else if (bmi >= 18 && bmi < 20) bmiPoints = 1;
        else if (bmi >= 20 && bmi < 35) bmiPoints = 0;
        else if (bmi >= 35 && bmi < 40) bmiPoints = 1;
        else if (bmi >= 40) bmiPoints = 3;

        score += bmiPoints;
        if (bmiPoints > 0) breakdown.push(BMI (${bmi.toFixed(1)}) = ${bmiPoints} pt${bmiPoints > 1 ? 's' : ''});
      }

      const fields = [
        {id:'cardiac', label:'Cardiac issues'},
        {id:'respiratory', label:'Respiratory issues'},
        {id:'neurological', label:'Neurological issues'},
        {id:'psychiatric', label:'Psychiatric issues'},
        {id:'getOut', label:'Cannot get out of house'},
        {id:'ageFlag', label:'Age threshold exceeded'},
        {id:'recentAdmit', label:'Recent hospital admission'},
        {id:'anaemia', label:'Anaemia'},
        {id:'revision', label:'Revision/complex primary'},
      ];

      fields.forEach(f=>{
        let val = parseInt(document.getElementById(f.id).value) || 0;
        if(val>0){
          score += val;
          breakdown.push(${f.label} = ${val} pt${val>1?'s':''});
        }
      });

      const meds = parseInt(document.getElementById('numMeds').value) || 0;
      if (meds >= 5){
        score += 1;
        breakdown.push(Non-analgesic medications (${meds}) = 1 pt);
      }

      const diabetesPts = parseInt(document.getElementById('diabetes').value) || 0;
      if(diabetesPts>0){
        score += diabetesPts;
        const diabetesLabel = document.getElementById('diabetes').options[document.getElementById('diabetes').selectedIndex].text;
        breakdown.push(Diabetes: ${diabetesLabel} = ${diabetesPts} pt${diabetesPts>1?'s':''});
      }

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value);
const doac = parseInt(document.getElementById('doac').value);
const immuno = parseInt(document.getElementById('immuno').value);

// üîπ Capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// Apply to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// Immunosuppressants still fixed at 3 points (unchanged)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

// Antiplatelet = 2 points
if (antiplatelet > 0) {
  score += 2;
  breakdown.push('On Antiplatelet = 2 pts');
}

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET (CLEAN VERSION)
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value) || 0;
const doac = parseInt(document.getElementById('doac').value) || 0;
const immuno = parseInt(document.getElementById('immuno').value) || 0;

// First: add immunosuppressants (these are NOT part of the variable rule)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

// üëâ NOW capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply variable points to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}

// Apply variable points to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''});
}
      let risk='', riskClass='';
      if (score >= 6){ risk='Red'; riskClass='red'; }
      else if (score >= 3){ risk='Amber'; riskClass='amber'; }
      else { risk='Green'; riskClass='green'; }

      const autoNoFields = ['rrt','antiplatelet','doac','glp1','immuno','notice'];
      let autoNo = autoNoFields.some(id => parseInt(document.getElementById(id).value) > 0);

      if (parseInt(document.getElementById('revision').value) === 3 ||
          parseInt(document.getElementById('anaemia').value) === 3) {
        autoNo = true;
      }

      let suitable = "Yes";
      let suitableClass = "green";
      if(score > 8 || autoNo) {
        suitable = "No";
        suitableClass = "red";
      }

      let fourJoint = "Yes";
      let fourJointClass = "green";
      let fourJointReason = "";

      let reasons = [];
      if (risk !== 'Green') reasons.push(RAG pathway is ${risk});
      if (!isNaN(bmi) && bmi >= 35) reasons.push(BMI is ${bmi.toFixed(1)} (‚â• 35));

      if (reasons.length > 0) {
        fourJoint = "No";
        fourJointClass = "red";
        fourJointReason = reasons.join(" and ");
      }

      document.getElementById('result').innerHTML =
        <strong>Total Score: ${score}</strong><br>
         <span class="${riskClass}"><strong>RAG Category: ${risk}</strong></span><br>
         <strong>Suitable to come in on same day?:</strong>
         <span class="${suitableClass}">${suitable}</span><br>
         <strong>Suitable for 4 joint list?:</strong>
         <span class="${fourJointClass}">
           ${fourJoint}
           ${fourJointReason ? <span class="info-icon">i<span class="tooltip">${fourJointReason}</span></span> : ''}
         </span>
         <div style="margin-top:10px;">
         <strong>Breakdown:</strong>
         <ul>${breakdown.map(x=><li>${x}</li>).join('')}</ul>
         </div>;
    }
  </script>
</body>
</html>
ChatGPT said:
Thanks ‚Äî this helps a lot. The file you‚Äôve pasted still contains three different drug-scoring blocks at once, including:

a first ‚Äúvariable‚Äù block,

an old fixed +2 points block, and

the ‚Äúclean version‚Äù again at the bottom,

plus you redeclare antiplatelet, doac, immuno, baseScore, and getDrugPoints multiple times.
That will break the script (or make it double/triple count).

Below is the minimal, correct fix you can copy‚Äìpaste.

üëâ STEP 1 ‚Äî DELETE ALL of this section
In your file, remove everything from here:

// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET
// -----------------------------
down to just before:

let risk='', riskClass='';
(Delete all of it ‚Äî including the old ‚ÄúAntiplatelet = 2 points‚Äù block and the second ‚Äúclean version‚Äù.)

üëâ STEP 2 ‚Äî Paste ONLY THIS ONE BLOCK in its place
// -----------------------------
// VARIABLE SCORING FOR DOAC & ANTIPLATELET (FINAL WORKING VERSION)
// -----------------------------

const antiplatelet = parseInt(document.getElementById('antiplatelet').value) || 0;
const doac = parseInt(document.getElementById('doac').value) || 0;
const immuno = parseInt(document.getElementById('immuno').value) || 0;

// First: add immunosuppressants (these are NOT part of the variable rule)
if (immuno > 0) {
  score += 3;
  breakdown.push('On Immunosuppressants = 3 pts');
}

// üëâ Now capture the score BEFORE adding DOAC or Antiplatelet
let baseScore = score;

function getDrugPoints(base) {
  if (base === 0) return 3;
  if (base === 1) return 2;
  if (base === 2) return 1;
  return 0; // base >= 3
}

const variablePoints = getDrugPoints(baseScore);

// Apply variable points to Antiplatelet
if (antiplatelet > 0) {
  score += variablePoints;
  breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}

// Apply variable points to DOAC
if (doac > 0) {
  score += variablePoints;
  breakdown.push(`On DOAC = ${variablePoints} pt${variablePoints !== 1 ? 's' : ''}`);
}
‚úÖ After this, the behaviour will be correct
Score from everything else (baseScore)	Points from DOAC	Points from Antiplatelet
0	3	3
1	2	2
2	1	1
3 or more (e.g., Respiratory = 3)	0 ‚úÖ	0 ‚úÖ
So your earlier test:

Respiratory = 3 ‚Üí baseScore = 3

DOAC = Yes ‚Üí adds 0 (correct)

If you want, I can make this clearer to users by:
adding a tooltip explaining the rule, or

showing ‚ÄúBase score before blood thinners: X‚Äù in the breakdown.

Just tell me üëç

You said:
write the whole code in one go
ChatGPT said:
Absolutely ‚Äî I‚Äôve cleaned up your code and integrated the correct variable scoring for DOACs and antiplatelets, so it works exactly as you described. Everything else remains the same. Here‚Äôs the full working HTML + JS:

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAG calculator</title>
  <style>
    body{
      font-family:Arial, sans-serif;
      background:#f3f6fb;
      color:#222;
      margin:0;
      padding:24px;
    }
    .container{
      max-width:900px;
      margin:auto;
      background:#fff;
      padding:24px;
      border-radius:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    h1{margin-top:0}
    label{display:block;margin-top:12px;font-weight:bold}
    input,select{
      width:100%;
      padding:8px;
      margin-top:4px;
      box-sizing:border-box;
      border:1px solid #ccc;
      border-radius:6px;
    }
    button{
      margin-top:20px;
      padding:10px 14px;
      background:#007bff;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover{background:#0056b3;}
    #result{
      margin-top:20px;
      padding:14px;
      border-radius:10px;
      background:#f8f9fb;
      border:1px solid #e0e4ea;
    }
    .green{color:green; font-weight:bold;}
    .amber{color:orange; font-weight:bold;}
    .red{color:red; font-weight:bold;}
    ul{margin-top:6px; padding-left:18px;}
    li{margin-bottom:4px;}

    /* Black info icon with tooltip */
    .info-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      line-height: 16px;
      border-radius: 50%;
      border: 1.5px solid #000; /* black outline */
      background: transparent;   /* transparent inside */
      color: #000;               /* black "i" */
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      margin-left: 6px;
      cursor: pointer;
      position: relative;
    }
    .info-icon .tooltip {
      visibility: hidden;
      opacity: 0;
      width: max-content;
      max-width: 250px;
      background-color: #000; /* black background */
      color: #fff;            /* white text */
      text-align: left;
      border-radius: 6px;
      padding: 6px 10px;
      position: absolute;
      z-index: 1;
      top: -5px;
      left: 105%;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.3;
      white-space: pre-wrap;
    }
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RAG Calculator</h1>

    <label>BMI</label>
    <input type="number" id="bmi" placeholder="Enter BMI" step="0.1" min="0">

    <label>Cardiac issues</label>
    <select id="cardiac">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Respiratory issues</label>
    <select id="respiratory">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Neurological issues</label>
    <select id="neurological">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Psychiatric issues</label>
    <select id="psychiatric">
      <option value="0">None</option>
      <option value="1">Yes in the past but I have no/minimal symptoms now</option>
      <option value="3">Yes, and I have ongoing symptoms</option>
    </select>

    <label>Can they get out of the house on their own?</label>
    <select id="getOut">
      <option value="0">Yes</option>
      <option value="1">No</option>
    </select>

    <label>Diabetes</label>
    <select id="diabetes">
      <option value="0">None</option>
      <option value="1">Well controlled diabetes with no more than 2 medications</option>
      <option value="2">On Insulin or more than 2 diabetic medications</option>
      <option value="3">On Insulin and more than 2 other diabetic medications</option>
    </select>

    <label>Age &gt;80 for knee or &gt;85 for hip</label>
    <select id="ageFlag">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Recent hospital admission (past 6 weeks)</label>
    <select id="recentAdmit">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Are you known to be anaemic</label>
    <select id="anaemia">
      <option value="0">No / Don't know</option>
      <option value="1">Yes - stable and receiving treatment</option>
      <option value="3">Yes and waiting for further investigations</option>
    </select>

    <label>On renal replacement therapy</label>
    <select id="rrt">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>How many medications are you on (apart from pain killers)?</label>
    <input type="number" id="numMeds" placeholder="Enter number" min="0">

    <label>Revision surgery, complex primary or bilateral joints</label>
    <select id="revision">
      <option value="0">No</option>
      <option value="3">Yes</option>
    </select>

    <label>On Clopidogrel / Ticagrelor / Prasugrel</label>
    <select id="antiplatelet">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On DOAC (Apixaban / Rivaroxaban / Dabigatran etc)</label>
    <select id="doac">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On GLP1 agonist (Ozempic / Mounjaro / Wegovy / Tirzepatide / Rybelsus etc)</label>
    <select id="glp1">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>On Immunosuppressants</label>
    <select id="immuno">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <label>Patient needs more than 24 hours notice</label>
    <select id="notice">
      <option value="0">No</option>
      <option value="1">Yes</option>
    </select>

    <button onclick="calculateScore()">Calculate Score</button>

    <div id="result"></div>
  </div>

  <script>
    function calculateScore(){
      let score = 0;
      let breakdown = [];

      // BMI scoring
      const bmi = parseFloat(document.getElementById('bmi').value);
      let bmiPoints = 0;
      if (!isNaN(bmi)) {
        if (bmi < 18) bmiPoints = 3;
        else if (bmi >= 18 && bmi < 20) bmiPoints = 1;
        else if (bmi >= 20 && bmi < 35) bmiPoints = 0;
        else if (bmi >= 35 && bmi < 40) bmiPoints = 1;
        else if (bmi >= 40) bmiPoints = 3;
        score += bmiPoints;
        if (bmiPoints>0) breakdown.push(`BMI (${bmi.toFixed(1)}) = ${bmiPoints} pt${bmiPoints>1?'s':''}`);
      }

      // Core fields
      const fields = [
        {id:'cardiac', label:'Cardiac issues'},
        {id:'respiratory', label:'Respiratory issues'},
        {id:'neurological', label:'Neurological issues'},
        {id:'psychiatric', label:'Psychiatric issues'},
        {id:'getOut', label:'Cannot get out of house'},
        {id:'ageFlag', label:'Age threshold exceeded'},
        {id:'recentAdmit', label:'Recent hospital admission'},
        {id:'anaemia', label:'Anaemia'},
        {id:'revision', label:'Revision/complex primary'},
      ];

      fields.forEach(f=>{
        let val = parseInt(document.getElementById(f.id).value)||0;
        if(val>0){
          score += val;
          breakdown.push(`${f.label} = ${val} pt${val>1?'s':''}`);
        }
      });

      // Medications
      const meds = parseInt(document.getElementById('numMeds').value)||0;
      if(meds>=5){
        score += 1;
        breakdown.push(`Non-analgesic medications (${meds}) = 1 pt`);
      }

      // Diabetes
      const diabetesPts = parseInt(document.getElementById('diabetes').value)||0;
      if(diabetesPts>0){
        score += diabetesPts;
        const diabetesLabel = document.getElementById('diabetes').options[document.getElementById('diabetes').selectedIndex].text;
        breakdown.push(`Diabetes: ${diabetesLabel} = ${diabetesPts} pt${diabetesPts>1?'s':''}`);
      }

      // -----------------------------
      // DOAC & Antiplatelet variable scoring
      // -----------------------------
      const antiplatelet = parseInt(document.getElementById('antiplatelet').value)||0;
      const doac = parseInt(document.getElementById('doac').value)||0;
      const immuno = parseInt(document.getElementById('immuno').value)||0;

      // Immunosuppressants fixed 3 points
      if(immuno>0){
        score += 3;
        breakdown.push('On Immunosuppressants = 3 pts');
      }

      // Base score before DOAC/Antiplatelet
      let baseScore = score;

      function getDrugPoints(base){
        if(base===0) return 3;
        if(base===1) return 2;
        if(base===2) return 1;
        return 0; // base >=3
      }

      const variablePoints = getDrugPoints(baseScore);

      // Apply variable points
      if(antiplatelet>0){
        score += variablePoints;
        breakdown.push(`On Antiplatelet = ${variablePoints} pt${variablePoints!==1?'s':''}`);
      }
      if(doac>0){
        score += variablePoints;
        breakdown.push(`On DOAC = ${variablePoints} pt${variablePoints!==1?'s':''}`);
      }

      // -----------------------------
      // RAG Category
      // -----------------------------
      let risk='', riskClass='';
      if(score>=6){ risk='Red'; riskClass='red'; }
      else if(score>=3){ risk='Amber'; riskClass='amber'; }
      else { risk='Green'; riskClass='green'; }

      // Auto No checks
      const autoNoFields = ['rrt','antiplatelet','doac','glp1','immuno','notice'];
      let autoNo = autoNoFields.some(id => parseInt(document.getElementById(id).value)>0);
      if(parseInt(document.getElementById('revision').value)===3 || parseInt(document.getElementById('anaemia').value)===3){
        autoNo=true;
      }

      let suitable="Yes", suitableClass="green";
      if(score>8 || autoNo){ suitable="No"; suitableClass="red"; }

      let fourJoint="Yes", fourJointClass="green", fourJointReason="";
      let reasons=[];
      if(risk!=='Green') reasons.push(`RAG pathway is ${risk}`);
      if(!isNaN(bmi) && bmi>=35) reasons.push(`BMI is ${bmi.toFixed(1)} (‚â• 35)`);
      if(reasons.length>0){ fourJoint="No"; fourJointClass="red"; fourJointReason=reasons.join(" and "); }

      // Output
      document.getElementById('result').innerHTML=
        `<strong>Total Score: ${score}</strong><br>
         <span class="${riskClass}"><strong>RAG Category: ${risk}</strong></span><br>
         <strong>Suitable to come in on same day?:</strong>
         <span class="${suitableClass}">${suitable}</span><br>
         <strong>Suitable for 4 joint list?:</strong>
         <span class="${fourJointClass}">
           ${fourJoint}
           ${fourJointReason?`<span class="info-icon">i<span class="tooltip">${fourJointReason}</span></span>`:''}
         </span>
         <div style="margin-top:10px;">
         <strong>Breakdown:</strong>
         <ul>${breakdown.map(x=>`<li>${x}</li>`).join('')}</ul>
         </div>`;
    }
  </script>
</body>
</html>
